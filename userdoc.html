<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Minnal - REST framework that helps you eliminate boiler plate code and build applications faster</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="subramanian.ganesh@gmail.com">

    <link rel="stylesheet" href="stylesheets/bootstrap.css">
    <link rel="stylesheet" href="stylesheets/shCoreEmacs.css">
    <link rel="stylesheet" href="stylesheets/shThemeEmacs.css">
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 40px;
      }
      .sidebar-nav {
        padding: 9px 0;
      }

      @media (max-width: 980px) {
        /* Enable use of floated navbar text */
        .navbar-text.pull-right {
          float: none;
          padding-left: 5px;
          padding-right: 5px;
        }
      }
    </style>
    <link href="stylesheets/bootstrap-responsive.css" rel="stylesheet">
    <link href="stylesheets/toc.css" rel="stylesheet">

    <script src="javascripts/jquery.min.js"></script>
    <script src="javascripts/bootstrap.min.js"></script>
    <script src="javascripts/shCore.js"></script>
    <script src="javascripts/shBrushJava.js"></script>
    <script src="javascripts/shBrushJScript.js"></script>
    <script src="javascripts/shBrushXml.js"></script>
    <script src="javascripts/shBrushSql.js"></script>
    <script src="javascripts/shBrushBash.js"></script>
    <script src="javascripts/jquery.toc.min.js"></script>
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="/minnal">Minnal</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li><a href="/minnal">Home</a></li>
              <li><a href="gstarted.html">Getting Started</a></li>
              <li class="active"><a href="userdoc.html">User Documentation</a></li>
              <li><a href="faq.html">FAQ</a></li>
              <li><a href="contact.html">Contact</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid">
      <a href="https://github.com/minnal/minnal">
        <img style="position: absolute; top: 0; right: 0; border: 0;z-index: 2000;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub">
      </a>
      <div class="row-fluid">
        <div class="span3">
          <div id="toc"></div>
        </div><!--/span-->
        <div class="span9">
          <div class="row-fluid">
            <h1>User Documentation</h1>
            <p>This document will provide you detailed information about the feature set of the minnal modules, configuring them, organizing your project, testing your application, extending minnal etc...</p>
            <p>You should read through <a href="gstarted.html">Getting Started</a> to get an understanding of the framework capabilities.</p>
            <h2>High level design</h2>
              <p>The core of minnal is the container under which multiple applications are run. The notion of <i>Container</i> and <i>Application</i> might be confusing here. Unlike application servers like Tomcat, minnal doesn't create a classloader per application deployed. The figure below shows the high level design of the framework</p>
              <img src="images/minnal.jpg"/>
              <p>At the low level is the container that defines the http connector and handles the incming request via a router. The router resolves the route from the request and deligates the request to application which in turn delegates to a route handler. The request optionally will go through a set of filters before hitting the controller method.</p>
              <p>The container allows bundles to hook into its life cyle. Bundles can provide custom functionality at container level and will have access to the container.</p>
              <p>The application allows plugins to hook into its life cycle. Plugins can provide custom functionality at application level and will have access to all the resources and routes with in the application</p>
            <h2>Modules</h2>
            This section explains in detail the usage of various modules offered by minnal.
            <h3>Minnal Core</h3>
            minnal-core is the core of the framework and doesn't depend on any of the other minnal modules. minna-core is a light weight REST application framework and can be used independent of instrumentation module.
            <h4>Organizing your project</h4>
            <p>Minnal recommends you to use maven for managing your project and its dependencies. If you are starting from scratch, take a look at <a href="#toc11">Minnal Generator</a> for creating a project. A minnal project structure would look like this,</p>
            <ul class="nav">
              <li><code>src/main/java</code>
                <ul>
                  <li><code>com.example</code>
                    <ul>
                      <li><code>ExampleApplication</code> <i>-- The application class</i></li>
                      <li><code>ExampleConfiguration</code> <i>-- The application configuration class</i></li>
                    </ul>
                  </li>
                  <li><code>com.example.domain</code> <i>-- Domain models get in here</i></li>
                  <li><code>com.example.resources</code> <i>-- Resource classes get in here</i></li>
                </ul>
              </li>
              <li><code>src/main/resources</code>
                <ul>
                  <li><code>META-INF</code>
                    <ul>
                      <li><code>services</code>
                        <ul>
                          <li><code>org.minnal.core.Application</code> <i>-- SPI for Application class</i></li>
                        </ul>
                      </li>
                      <li><code>container.yml</code> <i>-- Container configuration</i></li>
                      <li><code>example.yml</code> <i>-- Application configuration</i></li>
                    </ul>
                  </li>
                  <li><code>log4j.properties</code> <i>-- Logger configuration</i></li>
                </ul>
              </li>
              <li><code>src/test/java</code></li>
              <li><code>src/test/resources</code></li>
            </ul>
            <h4>Container Configuration</h4>
            <p>Minnal's configuration follows a composite pattern. Routes inherit from a Resource, Resources inherit from an Application and Applications inherit from Container. Minnal abstracts outa bunch of configuration parameters at container level and every component inherits them from their parent.</p>
            <p>The configuration is loaded from a <i>container.yml</i> file loacated under <i>META-INF/</i> folder in the classpath</p>
            <pre class="brush: js">
              # The name of the container
              name: My Container

              # The base path to use for the routes from all the applications
              basePath: /

              # Http server configuration
              server:
                connectors:
                  - port: 8080
                    scheme: http

              # The default http media type that this container would support. Can be overridden by applications
              defaultMediaType: application/json

              # The serializers to use for the supported media types
              serializers:
                application/json:
                  class: org.minnal.core.serializer.DefaultJsonSerializer

              # The mount points for the applications
              mounts:
                com.shopping.cart.ShoppingCartApplication: /
            </pre>
            <p>Take a look at the class <code>org.minnal.core.config.ContainerConfiguration</code> for all the available properties</p>
            <h5>Configuring SSL</h5>
            Enabling https is quite similar to http, just that ssl needs to be configured. Create a https connector and configure ssl,
            <pre class="brush: js">
              # Http server configuration
              server:
                connectors:
                  - port: 8080
                    scheme: http
                  - port: 8443
                    scheme: https
                    ssl:
                      keyStoreFile: /Users/ganeshs/keystore.jks
                      keyStorePassword: password
                      keyPassword: secret
            </pre>
            <p>Take a look the class <code>org.minnal.core.config.SSLConfiguration</code> for all the available properties</p>
            <h5>Mounting applications to the container</h5>
            <p>To mount an application to the container, you will have add the application class to the SPI of <code>org.minnal.core.Application</code>. The container loads all the applications from the SPI file and mounts them as configured in the <i>container.yml</i>. Create a file <i>org.minnal.core.Application</i> under <i>META-INF/services/</i> folder and the list of applications you want to add to the container,</p>
            <pre class="brush: js">
              com.example.shopping.cart.ShoppingCartApplication

            </pre>
            <h4>Creating an Application</h4>
            <p>Application class is the entry point to your application. The application specific configurations are read from <code>org.minna.core.config.ApplicationConfiguration</code> class and you will have to extend it to create your application specific configuration</p>
            <pre class="brush: java">
              package com.example;

              public class ExampleConfiguration extends ApplicationConfiguration {

              }
            </pre>
            <p>You create an application by extending the class <code>org.minnal.core.Application</code>.</p>
            <pre class="brush: java">
              package com.example;

              public class ExampleApplication extends Application&lt;ExampleConfiguration&gt; {

                @Override
                protected void defineRoutes() {
                }

                @Override
                protected void defineResources() {
                  addResource(ExmapleResource.class);
                }

                @Override
                protected void addFilters() {
                }

                @Override
                protected void registerPlugins() {
                }
              }
            </pre>
            <h5>Application Configuration</h5>
            <p>Application inherits the configuration parameters from container. For instance, if you haven't set any serialiers for json content type, it will get it from container. You can override it by explicitly specifying in the ApplicationConfiguration. Minnal looks for the application configuration under <i>META-INF/</i> folder in the classpath. Be sure to name the file as lowercased application name. For instance if your application class name is <code>ShoppingCartApplication</code>, then the application config file name should be <code>shoppingcart.yml</code>. Bare minimum, the application config requires a name to be defined</p>
            <pre class="brush: js">
              # The name of the application
              name: shopping_cart
            </pre>
            <h5>Database Configuration</h5>
            <p>Minnal recommends you to use JPA in your persistence layer but the database configuration is generic enough to use any library in your peristence layer</p>
            <pre class="brush: js">
              db:
                driverClass: com.mysql.jdbc.Driver
                url: jdbc:mysql://localhost/facilities
                username: root
                providerProperties:
                  hibernate.ejb.naming_strategy: org.hibernate.cfg.ImprovedNamingStrategy
                  hibernate.show_sql: true
                  hibernate.format_sql: false
                  hibernate.current_session_context_class: thread
                  hibernate.dialect: org.hibernate.dialect.MySQLDialect
                packagesToScan: 
                  - com.ekl.facilities
                  - org.minnal.security.session
                  - org.minnal.security.auth.cas
            </pre>
            <p>Minnal uses c3p0 for connection pooling. Take a look at the class <code>org.minnal.core.config.ApplicationConfiguration</code> for all the available properties</p>
            <h4>Creating a Resource</h4>
            Creating a resource is straight forward. Unlike <i>Application</i>, resource class need not extend any framework specific classes. You create a resource under <code>com.example.resources</code> package.
            <pre class="brush: java">
              package com.example.resources;

              public class ExampleResource {

                /**
                 * Maps to the route GET /examples/:id
                 */
                public void readExample(Request request, Response response) {
                  String id = request.getHeader("id");
                  Example example = null;
                  // Read example from your persistence store
                  response.setContent(example);
                  response.setStatus(HttpResponseStatus.OK);
                }

                /**
                 * Maps to the route POST /examples/
                 */
                public Example createExample(Request request, Response response) {
                  Example example = request.getContentAs(Example.class)
                  // Write example to your persistence store
                  return example;
                }
              }
            </pre>
            <p>The only constraint the framework imposes on you is on the method signature of your resource methods. Your resource methods should take in an instance of <code>org.minnal.core.Request</code> and <code>org.minnal.core.Resposne</code>. The method can return void or the content to set in the response. In case you return the content from the method, minnal will set the content and set the status to <i>200 OK</i>. It will safely ignore the return value if the resposne content is already set.</p>
            <p>Minnals writes all the query and form parameters to request headers and you can access them by calling <code>request.getHeader("param")</code></p>
            <p>The resource should be added to your Application to define the routes. You do this by adding the resource in the defineResources() method of the application class</p>
            <pre class="brush: java">
              public class ExampleApplication extends Application&lt;ExampleConfiguration&gt; {
               
                @Override
                protected void defineResources() {
                  addResource(ExmapleResource.class);
                }
              }
            </pre>
            <h5>Resource configuration</h5>
            <p>By default minnal inherits the application configuration parameters in to the resource configuration. In most cases you won't have a need to customize these properties. But say if you want to accept the <i>text/csv</i> which is not the default content type specified by the application, you can customize the resource configuration by just pass on an instance of resource configuration to addResource method.</p>
            <pre class="brush: java">
              @Override
              protected void defineResources() {
                ResourceConfiguration configuration = new ResourceConfiguration("example resource");
                configuration.addSerializer(MediaType.CSV_UTF_8, csvSerializer);
                addResource(ExmapleResource.class, configuration);
              }
            </pre>
            <p>Take a look at the class <code>org.minnal.core.config.ResourceConfiguration</code> for all the available properties</p>
            <h4>Creating the routes</h4>
            <p>Routes are associated with resource classes. You add routes in the defineRoutes() method of the application class</p>
            <pre class="brush: java">
              public class ExampleApplication extends Application&lt;ExampleConfiguration&gt; {
               
                @Override
                protected void defineRoutes() {
                  // Map ExampleResource.readExample method to the route GET /examples/{id}
                  resource(ExampleResource.class).builder("/examples/{id}").action(HttpMethod.GET, "readExample");

                  // You can also chain the actions for a route
                  resource(ExampleResource.class).builder("/examples/{id}").action(HttpMethod.PUT, "updateExample").action(HttpMethod.DELETE, "deleteExample");                  
                }
              }
            </pre>
            <h5>Route Configuration</h5>
            <p>By default minnal inherits the resource configuration parameters in to the route configuration. You can customize the route configuration as below,</p>
            <pre class="brush: java">
              @Override
              protected void defineRoutes() {
                RouteConfiguration configuration = new RouteConfiguration("some name");
                configuration.addSerializer(MediaType.CSV_UTF_8, csvSerializer);

                // Map ExampleResource.readExample method to the route GET /examples/{id}
                resource(ExampleResource.class).builder("/examples/{id}").action(HttpMethod.GET, "readExample").using(configuration);
              }
            </pre>
            <p>Take a look at the class <code>org.minnal.core.config.RouteConfiguration</code> for all the available properties</p>
            <h4>Creating a filter</h4>
            <p>Minnal provides support for chaining of filters like in http-servlets. The request will pass through all the filters before hitting the controller. To create a filter, implement the interface <code>org.minnal.core.Filter</code></p>
            <pre class="brush: java">
              public class MyFilter implements Filter {

                @Override
                public void doFilter(Request request, Response response, FilterChain chain) {
                  // pre process request
                  chain.doFilter(request, response);
                  // post process response
                }
              }
            </pre>
            <h4>Adding a filter to the application</h4>
            <p>You can add filters to the application in the addFilters() method</p>
            <pre class="brush: java">
              public class ExampleApplication extends Application&lt;ExampleConfiguration&gt; {
                @Override
                protected void addFilters() {
                  addFilter(new MyFilter());
                }
              }
            </pre>
            <h4>Handling exceptions</h4>
            <p>Minnal defines a bunch of application exceptions that gets translated to meaningful HTTP response codes. These exceptions are defined under the package <code>org.minnal.core.server.exception</code>. Below are some of them, take a look at the exception package for other exception types</p>
            <ul>
              <li><code>BadRequestException:</code> -- 400 Bad Request</li>
              <li><code>ConflictException:</code> -- 409 Conflict</li>
              <li><code>MethodNotAllowedException:</code> -- 405 Method Not Allowed</li>
            </ul>
            <h5>Mapping Exceptions</h5>
            <p>You can map your exceptions to an application exception. You have to override the method mapExceptions() in the application class to do this</p>
            <pre class="brush: java">
              public class ExampleApplication extends Application&lt;ExampleConfiguration&gt; {
                @Override
                protected void mapExceptions() {
                  addExceptionMapping(PersistenceException.class, BadRequestException.class);
                  super.mapExceptions();
                }
              }
            </pre>
            <h4>Creating a plugin</h4>
            <p>Plugin hooks into the lifecycle of an application. Minnal invokes the plugin when an application is intialized or destroyed. Creating a plugin is fairly simple, you will just have to implement the interface <code>org.minnal.core.Plugin</code></p>
            <pre class="brush: java">
              public class MyPlugin implements Plugin {

                @Override
                public void init(Application application) {
                  System.out.println("Initializing the plugin");
                }

                @Override
                public void destroy() {
                  System.out.println("Destroying the plugin");
                }
              }
            </pre>
            <h4>Registering a plugin to the application</h4>
            <p>You can register a plugin in the registerPlugins() method of the application class</p>
            <pre class="brush: java">
              public class ExampleApplication extends Application&lt;ExampleConfiguration&gt; {
               
                @Override
                protected void registerPlugins() {
                  registerPlugin(new MyPlugin());
                }
              }
            </pre>
            <p>The registered plugins will be invoked in the same order they are registered</p>
            <h4>Creating a bundle</h4>
            <p>Bundles hook into the life cycle of the container. Bundle gets access to the container. The container invokes the bundle when the container is initialized, started, stopped. To cretae a bundle, simply implement the interface <code>org.minnal.core.Bundle</code></p> 
            <pre class="brush: java">
              public class MyBundle implements Bundle {

                public void init(Container container) {
                  System.out.println("Intializing the bundle");
                }

                public void start() {
                  System.out.println("Starting the bundle");
                }

                public void stop() {
                  System.out.println("Stopping the bundle");
                }
              }
            </pre>
            <h4>Adding a bundle to the container</h4>
            <p>To add a bundle to the container, you will have to add the bundle class to the SPI of <code>org.minnal.core.Bundle</code> under <i>META-INF/</i> folder, </p>
            <pre class="brush: js">
              com.example.MyBundle

            </pre>
            <h3>Minnal Jpa</h3>
            minnal-jpa has useful abstractions for your DAL. It makes use of <a href="https://github.com/ActiveJpa/activejpa">ActiveJpa</a>, a java library that attempts to implement the active record pattern on top of JPA. It eliminates the need to create DAO or Repository classes and make programming DAL a lot more simpler</i>. Minnal recommends using JPA for DB access and provides a JPA plugin module with ActiveJpa integration.</p>
            <h4>Creating Domain Classes</h4>
            <p>Minnal Jpa provides a base domain class <code>org.minnal.jpa.entity.BaseDomain</code> which extends the ActiveJpa model class. Extending the base domain enables you to do ActiveRecord style operations like, <code>Person.find(1L);</code>, <code>Person.where("firstName", "Ganesh");</code> etc... </p>
            <pre class="brush: java">
              package com.example.domain;

              @Entity
              public class Example extends BaseDomain {

              }
            </pre>
            <h4>Configuring JPA</h4>
            <p>minnal-jpa provides a plugin <code>org.minnal.jpa.JPAPlugin</code> to configure JPA. You just need to register the plugin to your application</p> 
            <pre class="brush: java">
              public class ExampleApplication extends Application&lt;ExampleConfiguration&gt; {
               
                @Override
                protected void registerPlugins() {
                  registerPlugin(new JPAPlugin());
                }
              }
            </pre>
            <p>The JPAPlugin reads the database configuration from your application configuration and loads the <code>EntityManagerFactory</code>. You can configure the vendor specific properties in the db configuration section.</p>
            <h3>Minnal Migrations</h3>
            Work In Progress
            <h3>Minnal Instrumentation</h3>
            Work In Progress
            <h3>Minnal Security</h3>
            Work In Progress
            <h3>Minnal Admin</h3>
            Work In Progress
            <h3>Minnal Generator</h3>
              Work In Progress
            <h3>Minnal Test</h3>
              Work In Progress
            <h3>Minnal Examples</h3>
          </div>
        </div>
      </div>

      <hr>

      <footer>

      </footer>

    </div>


  </body>

  <!-- Finally, to actually run the highlighter, you need to include this JS on your page -->
<script type="text/javascript">
  SyntaxHighlighter.all();
  $('#toc').toc({
    'selectors': 'h1,h2,h3,h4,h5',
    'highlightOnScroll': false
  });

</script>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

                ga('create', 'UA-41566886-1', 'minnal.github.io');
                  ga('send', 'pageview');

                </script>
</html>
